<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Global Buddy Meetup Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body { margin:0; font-family: system-ui; background:#0f172a; color:#fff }
#panel { padding:10px; background:#020617; display:flex; gap:6px }
input,button { padding:6px; background:#111827; color:white; border:none }
#map { height:92vh }
</style>
</head>

<body>

<div id="panel">
  <input id="city" placeholder="City">
  <input id="from" type="date">
  <input id="to" type="date">
  <button onclick="addEntry()">Add</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let map = L.map('map').setView([20,0], 2);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:18
}).addTo(map);

let entries = JSON.parse(localStorage.getItem("meetups") || "[]");
let markers = [];

function render() {
  markers.forEach(m=>map.removeLayer(m));
  markers = [];

  entries.forEach(e=>{
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${e.city}`)
    .then(r=>r.json())
    .then(d=>{
      if(!d[0]) return;
      let m = L.marker([d[0].lat,d[0].lon]).addTo(map)
        .bindPopup(`<b>${e.city}</b><br>${e.from} â†’ ${e.to}`);
      markers.push(m);
    });
  });
}

function addEntry(){
  let city = city.value.trim();
  let from = document.getElementById("from").value;
  let to   = document.getElementById("to").value;
  if(!city||!from||!to) return alert("Fill all fields");

  entries.push({city,from,to});
  localStorage.setItem("meetups",JSON.stringify(entries));
  render();
}

render();
</script>
</body>
</html>
